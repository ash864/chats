<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sukuna Private Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Arial, sans-serif;
      background:#000; color:#ff2b2b;
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; -webkit-user-select:none; user-select:none;
    }
    input, textarea { user-select:text; }
    .container{width:100%; max-width:450px; padding:16px}
    .card{
      background:#0a0000;
      border:1px solid #ff0000aa;
      border-radius:12px;
      padding:12px;
      min-height:520px;
      display:flex; flex-direction:column;
      box-shadow:0 0 20px #ff000066;
    }
    #login, #chat{animation:fade .4s}
    @keyframes fade{from{opacity:0}to{opacity:1}}
    #messages{
      flex:1;
      overflow-y:auto;
      background:#1a0000aa;
      border:1px solid #ff000033;
      padding:10px;
      margin-bottom:10px;
      border-radius:8px;
      font-size:14px;
    }
    .msg{margin-bottom:10px; max-width:80%}
    .mine{text-align:right; margin-left:auto}
    .bubble{
      display:inline-block;
      padding:6px 10px;border-radius:12px;
      background:#330000;border:1px solid #ff000066;
    }
    .mine .bubble{background:#ff2b2b;color:#000}
    button{
      width:100%; padding:10px; background:#ff0000;
      color:#000; border:none; border-radius:8px; font-weight:bold;
    }
    #securityBanner{
      display:none;
      background:#ff0000;
      color:#000; text-align:center; padding:6px;
      font-size:12px; border-radius:5px;
    }
  </style>
</head>

<body>
<div class="container">
  <div class="card">

    <h2 style="text-align:center;margin-top:0;">Sukuna Chat</h2>

    <!-- LOGIN -->
    <div id="login">
      <input id="name" placeholder="Nickname" style="width:100%;margin-bottom:8px;">
      <input id="password" type="password" placeholder="Password" style="width:100%;margin-bottom:8px;">
      <button onclick="enterRoom()">Join</button>
    </div>

    <!-- CHAT -->
    <div id="chat" style="display:none;">
      <div id="messages"></div>

      <form id="sendForm">
        <textarea id="text" rows="2" placeholder="Type message..." style="width:100%;margin-bottom:6px;"></textarea>
        <button type="submit">Send</button>
      </form>

      <div id="securityBanner">âš  Screenshot detected! Messages cleared!</div>
    </div>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// ROOM + SECURITY SETTINGS
const ROOM_ID = "sukuna";
const ROOM_PASSWORD = "fuga";
const SELF_DESTRUCT_MS = 10000;

// Firebase Config (UPDATED URL)
const firebaseConfig = {
  apiKey: "AIzaSyA_nuzaF_aDVcYSGtDWXY6lTAQmM2VUSkA",
  authDomain: "chat-99c2e.firebaseapp.com",
  databaseURL: "https://chat-99c2e-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chat-99c2e",
  storageBucket: "chat-99c2e.firebasestorage.app",
  messagingSenderId: "275569346488",
  appId: "1:275569346488:web:081b3cbb0f347fe70cb14d",
  measurementId: "G-YQJLJT6F2J"
};

firebase.initializeApp(firebaseConfig);
let db = firebase.database(), dbRef=null, logRef=null, myName=null, maybeSS=false;

function enterRoom() {
  myName = name.value.trim();
  if (!myName) return alert("Enter nickname!");
  if (password.value.trim() !== ROOM_PASSWORD)
      return alert("Wrong password!");

  login.style.display="none";
  chat.style.display="block";

  dbRef = db.ref(`rooms/${ROOM_ID}/messages`);
  logRef = db.ref(`rooms/${ROOM_ID}/logs`);

  dbRef.on("child_added", snap=>{
    let m=snap.val(), now=Date.now();
    if (m.expiresAt <= now) { dbRef.child(snap.key).remove(); return; }
    displayMsg(snap.key, m);
  });
}

function displayMsg(key, m) {
  let div=document.createElement("div");
  div.className="msg "+(m.name===myName?"mine":"");
  div.innerHTML = `<div class='bubble'>${m.text}</div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;

  setTimeout(() => dbRef.child(key).remove(), m.expiresAt - Date.now());
}

sendForm.onsubmit = e => {
  e.preventDefault();
  let t=text.value.trim(); if(!t) return;
  let now=Date.now();
  dbRef.push({name:myName,text:t,time:now,expiresAt:now+SELF_DESTRUCT_MS});
  text.value="";
};

// Screenshot detection (limited support)
document.addEventListener("visibilitychange", () => {
  if (document.hidden) maybeSS=true;
  else if (maybeSS){
    maybeSS=false;
    dbRef.remove();
    securityBanner.style.display="block";
    setTimeout(()=>securityBanner.style.display="none",3000);
  }
});
</script>

</body>
</html>
